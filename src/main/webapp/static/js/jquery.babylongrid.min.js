!function(a,b,c){var d="babylongrid",e={scheme:[{minWidth:960,columns:4},{minWidth:720,columns:3},{minWidth:550,columns:2},{minWidth:0,columns:1}],display:null,firstToRight:!1,heightDivisor:25,afterRender:null},f=function(b,c){this.element=b,this.options=a.extend({},e,c),this._defaults=e,this._name=d,this.init()};f.prototype={init:function(){var c=this;a(this.element).wrapInner('<div class="babylongrid-container" />'),this.cacheElements(),this._setGrid(),a(b).resize(function(){c._setGrid()}),a(this.element).on("babylongrid:resize",function(){c._setGrid()}),a(this.element).on("babylongrid:load",function(){c._loadNewArticles()})},_loadNewArticles:function(){var b=this,c=a(this.element).children().not(".babylongrid-container");c.each(function(){b.cached.articles.push(this)}),b._setColumns(b.__currentColumns)},cacheElements:function(){var b=a(this.element),c=b.children(".babylongrid-container"),d=c.children();this.cached={element:b,container:c,articles:d}},_setGrid:function(){var b,c,d=this.cached.container,e=d.width(),f=this;a.each(this.options.scheme,function(){return this.minWidth<=e?(c=this.columns,b="container-"+c,d.hasClass(b)?f._resizeArticles():(d.removeClass().addClass("babylongrid-container").addClass(b),f.__currentColumns=c,f._setColumns(c)),!1):void 0}),this.options.afterRender&&this.options.afterRender()},_setColumns:function(a){var b,c=this.cached.container;c.children(".column").remove();for(var d=1;a>=d;d++)b='<div class="column column-'+d+'"></div>',c.append(b);c.children(".column").data("height",0),this._organizeArticles(a)},_organizeArticles:function(b){var c,d,e,f,g=this.cached.articles,h=this.cached.container,i=h.children(".column"),j=i.data("height")+1,k=this;this.options.display&&h.removeClass("tower").removeClass("city"),this.options.firstToRight&&i.filter(".column-"+b).data("height",-1),a.each(g,function(l){c=a(this),a.each(i,function(g){a(this).data("height")<j&&(j=a(this).data("height"),d=a(this)),g+1>=b&&(d.append(c),k.options.heightDivisor>1&&k._setArticleHeight(c),e=d.outerHeight(!0),d.data("height",e),j=e+1,f=d)}),l+1===g.length&&("hidden"===k.cached.element.css("visibility")&&k.cached.element.css("visibility","visible"),k.options.display&&("tower"===k.options.display?h.addClass("tower"):"city"===k.options.display&&h.addClass("city")))})},_setArticleHeight:function(a){a.removeAttr("style");var b=this.options.heightDivisor,c=a.height(),d=c%b;d>0&&a.height(c+b-d)},_resizeArticles:function(){var b=this;a.each(this.cached.articles,function(){b._setArticleHeight(a(this))})}},a.fn[d]=function(b){return this.each(function(){a.data(this,"plugin_"+d)||a.data(this,"plugin_"+d,new f(this,b))})}}(jQuery,window);