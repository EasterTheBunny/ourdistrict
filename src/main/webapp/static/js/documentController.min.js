function setCarouselHeight(){var height=$(window).height();$("body").prepend("<style>.owl-item.active { overflow: auto; height:"+height+"px; }</style>")}function addLayerToContainer(layer,parent){var newLayer=$("<div/>").addClass("indent").addClass(layer.attributes.part_type),head=$("<h5/>").addClass("header").text(layer.attributes.header),text=$("<p/>").addClass("text").text(layer.attributes.text),toAdd=[];layer.header?head.prepend($("<span/>").addClass("enum").text(layer.attributes.enum)):text.prepend($("<span/>").addClass("enum").text(layer.attributes.enum)),layer.attributes.header&&toAdd.push(head),layer.attributes.text&&toAdd.push(text),newLayer.append(toAdd).append(layerBtnSet(layer)),"quoted-block"!=layer.attributes.part_type&&newLayer.on("mouseover",function(e){e.stopPropagation(),$(".indent").removeClass("active"),$(this).addClass("active")}),parent.append(newLayer),layer.children&&layer.children.map(function(obj){addLayerToContainer(obj,newLayer)})}function layerBtnSet(layer){var container=$("<div/>").addClass("btn-set"),btn=$('<a class="btn btn-primary"><i class="glyphicon glyphicon-cog"></i></a>');return container.append([btn]),btn.on("click",function(){$("#text").show(),selectedLayer=layer,window.location.hash=layer.id,$("#layer-tree").tree("loadPart",billID,layer.id),$(".owl-carousel").trigger("to.owl.carousel",[1,250])}),container}function findPart(search,id){for(var found=null,x=0,len=search.length;x<len;x++){if(search[x].id==id){found=search[x];break}if(search[x].children){if(found=findPart(search[x].children,id))break}else found=null}return found}var billID="",selectedLayer=null;$(document).ready(function(){$(".owl-carousel").owlCarousel({items:1,mouseDrag:!1,touchDrag:!1,pullDrag:!1,dots:!1}),$("#layer-tree").tree(),$("#move").on("click",function(){$("#text").show(),$(".owl-carousel").trigger("to.owl.carousel",[1,250])}),$("#text").on("click",function(){$(this).hide(),$(".owl-carousel").trigger("to.owl.carousel",[0,250])}),$("#edit-node").on("local.setupEdit",function(event,node){var modal=$("#generic-modal");$(this).off("click").on("click",function(){var template=$("#edit-form").clone().html(),body=modal.find(".modal-body");modal.find(".modal-title").text("Edit Section Text");var commitBtn=modal.find("[name='generic-save']");body.empty().html(template);var header=body.find("input"),text=body.find("textarea");node.attributes.statement&&""!=node.attributes.statement?header.val(node.attributes.statement):header.hide(),text.val(node.attributes.details),commitBtn.off("click"),commitBtn.on("click",function(){var newNode={details:text.val()};header.val().length>0&&(newNode.statement=header.val()),newNode.details.length>0&&$.ajax({url:"/api/v1/bills/"+billID+"/parts/"+selectedLayer.id+"/nodes/"+node.id,method:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify(newNode)}).done(function(json){node.children?node.children.push(json.data):node.children=[json.data],$("#layer-tree").tree("update",node),$("#layer-tree").tree("selectNode",json.data)}).fail(function(jqXHR){var modal=$("#confirm-modal"),title=modal.find(".modal-title"),body=modal.find(".modal-body");title.text(jqXHR.statusText),body.text(jqXHR.responseText),modal.modal("show")}),modal.modal("hide")}),modal.modal("show")})}),$("#comment-btn").on("local.setup",function(event,node){var modal=$("#generic-modal");$(this).off("click").on("click",function(){var template=$("#comment-form").clone().html(),body=modal.find(".modal-body"),title=modal.find(".modal-title"),commitBtn=modal.find("[name='generic-save']");title.text("Add Comment"),body.empty().html(template);var text=body.find("textarea");commitBtn.off("click").on("click",function(){var newComment={text:text.val()};newComment.text.length>0&&$.ajax({url:"/api/v1/bills/"+billID+"/parts/"+selectedLayer.id+"/nodes/"+node.id+"/comments",method:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify(newComment)}).done(function(json){$("#layer-tree").tree("addComment",json.data)}).fail(function(jqXHR){var modal=$("#confirm-modal"),title=modal.find(".modal-title"),body=modal.find(".modal-body");title.text(jqXHR.statusText),body.text(jqXHR.responseText),modal.modal("show")}),modal.modal("hide")}),modal.modal("show")})}),setCarouselHeight(),$("#share-fb").on("click",function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(window.location.href),"pop","width=600, height=400, scrollbars=no");return!1}),$("#share-tw").on("click",function(){window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(window.location.href)+"&hashtags=becongress","pop","width=600, height=400, scrollbars=no");return!1});var path=window.location.pathname,match=path.match(/.+\/(.+?)$/);if(match.length>1){billID=match[1];var path="/api/v1/bills/"+billID+"?include=parts";$.ajax({url:path,method:"GET",dataType:"json"}).done(function(json){if(json.data){var attr=json.data.attributes,btn=$('<a class="btn btn-success" target="_blank" id="download">PDF Text</a>');if(btn.attr("href",attr.pdf),$("#bill-title").text(attr.official_title),$("#bill-preamble").html(attr.preamble),$("#bill-data").append(btn),json.data.relationships){var container=$("#bill-text");json.data.relationships.parts.map(function(obj){addLayerToContainer(obj,container)});var hash=window.location.hash.replace(/^#/,"");if(hash.length>0){var split=hash.split("::"),found=findPart(json.data.relationships.parts,split[0]);found&&($("#text").show(),selectedLayer=found,$("#layer-tree").tree("loadPart",billID,found.id),$(".owl-carousel").trigger("to.owl.carousel",[1,250]))}}}})}});